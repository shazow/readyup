(function(e){function t(t){for(var n,r,i=t[0],u=t[1],d=t[2],p=0,m=[];p<i.length;p++)r=i[p],o[r]&&m.push(o[r][0]),o[r]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);l&&l(t);while(m.length)m.shift()();return a.push.apply(a,d||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],n=!0,i=1;i<s.length;i++){var u=s[i];0!==o[u]&&(n=!1)}n&&(a.splice(t--,1),e=r(r.s=s[0]))}return e}var n={},o={1:0},a=[];function r(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=n,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var d=0;d<i.length;d++)t(i[d]);var l=u;a.push([2,0]),s()})({"1QRf":function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._v("Creating room...")])},o=[];s("VRzm");function a(e,t){for(var s=t||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",o=e;o>0;o--)n+=s[~~(Math.random()*s.length)];return n}var r={name:"Index",mounted:function(){var e=a(8);this.$router.push({name:"room",params:{id:e}})}},i=r,u=s("KHd+"),d=Object(u["a"])(i,n,o,!1,null,null,null);t["a"]=d.exports},2:function(e,t,s){e.exports=s("Vtdi")},"9CST":function(e,t,s){"use strict";var n=s("l2EK"),o=s.n(n);o.a},OrFz:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"room"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.setName(t)}}},[e._v("\n    I am "),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.displayname,expression:"displayname",modifiers:{trim:!0}}],attrs:{type:"text",maxlength:"10"},domProps:{value:e.displayname},on:{input:function(t){t.target.composing||(e.displayname=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}}),s("input",{attrs:{type:"submit",value:"Save"}})]),e._v("\n\n  Welcome to "+e._s(e.$store.state.room)+".\n\n  "),s("h2",[e._v("Online")]),s("ul",e._l(e.$store.state.peers,function(t,n){return s("li",{key:n,attrs:{title:n}},[e._v("\n      "+e._s(t.name||n)+"\n    ")])})),s("wall",{attrs:{room:e.room}}),s("Video")],1)},o=[],a=(s("f3/d"),s("VRzm"),function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"wall"},[s("h2",[e._v("Wall")]),s("ul",{staticClass:"posts"},[e._l(e.$store.state.posts,function(t,n){return s("li",{key:n,class:{announce:!t.from}},[t.from?s("span",{staticClass:"displayname"},[e._v(e._s(e.$store.getters.name(t.from)))]):e._e(),e._v(" "+e._s(t.text)+"\n    ")])}),s("li",[s("form",{on:{submit:function(t){return t.preventDefault(),e.post(t)}}},[s("span",{staticClass:"displayname"},[e._v(e._s(e.$store.getters.name(e.$store.state.me.id)))]),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.text,expression:"text",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"..."},domProps:{value:e.text},on:{input:function(t){t.target.composing||(e.text=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}}),s("input",{attrs:{type:"submit",value:"Post"}})])])],2)])}),r=[],i={name:"Wall",props:["room"],data:function(){return{text:""}},methods:{post:function(){this.$store.commit("addPost",this.text),this.text=""}}},u=i,d=(s("9CST"),s("KHd+")),l=Object(d["a"])(u,a,r,!1,null,"05b566b8",null),p=l.exports,m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"video"},[s("h2",[e._v("Video")]),s("form",{on:{submit:function(t){return t.preventDefault(),e.post(t)}}},[s("label",[e._v("Youtube Link")]),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.url,expression:"url",modifiers:{trim:!0}}],attrs:{type:"text",placeholder:"https://youtube.com/..."},domProps:{value:e.url},on:{input:function(t){t.target.composing||(e.url=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}}),s("input",{attrs:{type:"submit",value:"Set"}})]),e.$store.state.video.id?s("youtube",{ref:"youtube",attrs:{"video-id":e.$store.state.video.id},on:{playing:e.handlePlaying,paused:e.handlePaused,ready:e.handleReady}}):e._e()],1)},c=[],f=s("Kw5r"),v=s("9t1k");f["a"].use(v["a"]);var h={name:"Video",data:function(){return{url:"",paused:!0,player:null,pulling:!1}},methods:{handleReady:function(e){this.player=e,this.pullState()},handlePlaying:function(){this.paused=!1;var e=this.$store.state.video;if(this.pulling){this.pulling=!1;var t=e.timestamp?(+new Date-e.timestamp)/1e3:0;this.seek(t+e.offset)}this.pushState()},handlePaused:function(){this.paused=!0,this.pushState()},pushState:function(){this.$store.state.video.paused!==this.paused&&this.$store.commit("setVideo",{paused:this.paused,offset:this.getOffset(),id:this.$store.state.video.id})},pullState:function(e){var t=void 0!==e?e.video:this.$store.state.video;if(t.paused!==this.paused)if(t.paused)this.pause();else{if(t.timestamp){var s=(+new Date-t.timestamp)/1e3;this.seek(s+t.offset)}this.pulling=!0,this.play()}},seek:function(e){return e&&this.player&&this.player.seekTo(e)},play:function(){return this.player&&this.player.playVideo()},pause:function(){return this.player&&this.player.pauseVideo()},isPlaying:function(){return this.player&&1===this.player.getPlayerState()},getOffset:function(){return this.player&&this.player.getCurrentTime()||0},post:function(){this.$store.commit("setVideo",{paused:!0,offset:0,id:this.$youtube.getIdFromURL(this.url)}),this.url=""}},mounted:function(){this.$store.subscribe(function(e,t){"handleReceive"===e.type&&void 0!==e.payload.data.video&&e.payload.data.video.paused!==this.paused&&this.pullState(t)}.bind(this))}},y=h,b=Object(d["a"])(y,m,c,!1,null,null,null),g=b.exports,w={name:"Room",data:function(){return{room:this.$route.params.id,displayname:this.$store.state.me.name}},methods:{setName:function(){this.$store.commit("setMe",{name:this.displayname})}},components:{Wall:p,Video:g},created:function(){this.$store.dispatch("setRoom",this.room)}},_=w,x=Object(d["a"])(_,n,o,!1,null,null,null);t["a"]=x.exports},Pf3K:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("h1",[e._v("readyup")]),s("p",[e._v("\n    Coordinate your work or play sessions with your friends.\n  ")]),s("router-view",{staticClass:"view"})],1)},o=[],a=(s("VRzm"),{name:"app"}),r=a,i=(s("nNx0"),s("KHd+")),u=Object(i["a"])(r,n,o,!1,null,null,null);t["a"]=u.exports},Vtdi:function(e,t,s){"use strict";s.r(t),function(e){s("VRzm");var n=s("Kw5r"),o=s("jE9Z"),a=s("wNa6"),r=s("Pf3K"),i=s("OrFz"),u=s("1QRf");n["a"].config.productionTip=!1,n["a"].use(o["a"]);var d=new o["a"]({mode:"hash",base:e,routes:[{path:"/",name:"index",component:u["a"]},{path:"/room/:id",name:"room",component:i["a"]}]}),l=new n["a"]({router:d,store:a["a"],render:function(e){return e(r["a"])}}).$mount("#app");t["default"]={app:l}}.call(this,"/")},boi5:function(e,t,s){},l2EK:function(e,t,s){},nNx0:function(e,t,s){"use strict";var n=s("boi5"),o=s.n(n);o.a},wNa6:function(e,t,s){"use strict";s("f3/d");var n=s("Kw5r"),o=s("L2JU"),a=s("d74P"),r=s.n(a),i=new window.Ipfs({EXPERIMENTAL:{pubsub:!0},config:{Addresses:{Swarm:["/dns4/ws-star.discovery.libp2p.io/tcp/443/wss/p2p-websocket-star"]}}});n["a"].use(o["a"]);var u,d=10,l=window.localStorage;function p(e){return e}function m(){return l.getItem("name")}function c(e,t){if(!t)return"Anonymoose";var s=e.peers[t];return s&&s.name?s.name:p(t)}t["a"]=new o["a"].Store({strict:!0,state:{me:{id:"",name:m()},ready:!1,room:"",posts:[],video:{id:"",paused:!1,timestamp:0,offset:0},peers:{},started:+new Date,askedState:!1},getters:{name:function(e){return function(t){return c(e,t)}}},mutations:{handleReceive:function(e,t){var s=t.from,o=t.data;o.post&&(e.posts.push({from:s,text:o.post}),e.posts.length>d&&e.posts.shift()),o.name&&n["a"].set(e.peers,s,{name:o.name}),o.sync&&o.sync>e.started&&u.sendTo(s,JSON.stringify({state:{video:e.video,posts:e.posts,peers:e.peers}})),o.state&&e.askedState===s&&(e.me.id&&e.me.name&&(o.state.peers[e.me.id]={name:e.me.name},u.broadcast(JSON.stringify({name:e.me.name}))),e.askedState=!1,e.video=o.state.video,e.posts=o.state.posts,e.peers=o.state.peers),o.video&&(e.video.id!==o.video.id?e.posts.push({text:"Video set by "+c(e,s)}):e.video.paused&&!o.video.paused?e.posts.push({text:"Video started by "+c(e,s)+" at "+Math.round(o.video.offset,0)+"s"}):!e.video.paused&&o.video.paused?e.posts.push({text:"Video paused by "+c(e,s)}):!e.video.offset!==o.video.offset&&e.posts.push({text:"Video jumped by "+c(e,s)}),e.video=o.video)},addPost:function(e,t){e.ready?u.broadcast(JSON.stringify({post:t})):e.posts.push({from:e.me.id,text:t})},reset:function(e){e.room="",e.posts=[],e.peers={},e.video={id:"",paused:!1,timestamp:0}},setMe:function(e,t){var s=t.id,o=t.name;s&&e.me.id!==s&&(e.me.id&&n["a"].delete(e.peers,e.me.id),n["a"].set(e.me,"id",s)),o?(l.setItem("name",o),n["a"].set(e.me,"name",o),u.broadcast(JSON.stringify({name:o}))):e.me.name&&u.broadcast(JSON.stringify({name:e.me.name}))},setRoom:function(e,t){e.room=t},setVideo:function(e,t){var s=t.id,n=t.paused,o=t.offset,a=+new Date;u.broadcast(JSON.stringify({video:{id:s,paused:n,timestamp:a,offset:o}}))},addPeer:function(e,t){n["a"].set(e.peers,t,{})},removePeer:function(e,t){n["a"].delete(e.peers,t)},ready:function(e,t){e.ready=t},waitSync:function(e,t){e.askedState=t}},actions:{setRoom:function(e,t){var s=this,n=e.commit,o=e.state,a=e.dispatch;t!==o.room&&(o.ready&&n("ready",!1),u&&(u.leave(),n("reset")),n("setRoom",t),i.on("ready",function(){console.log("ready",s),u=r()(i,o.room),i.id().then(function(e){n("setMe",{id:e.id})});var e=0;u.on("peer joined",function(t){console.log("peer joined",t),e+=1,n("addPeer",t),1===e&&a("requestState",t)}),u.on("peer left",function(e){console.log("peer left",e),n("removePeer",e)}),u.on("subscribed",function(e){console.log("peer subscribed",e),e!==t&&console.error("wrong room, this should not happen"),n("ready",!0)}),u.on("message",function(e){var t=JSON.parse(e.data);console.log("message",e.from,t),n("handleReceive",{from:e.from,data:t})})}))},requestState:function(e,t){var s=e.commit,n=e.state;if(void 0===t){var o=u.getPeers();if(0===o.length)return;var a=~~(Math.random()*o.length);t=o[a]}s("waitSync",t),u.sendTo(t,JSON.stringify({sync:n.started}))}}})}});
//# sourceMappingURL=app.56c6d1c7.js.map